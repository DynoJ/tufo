<div *ngIf="!climb" class="p">Loading...</div>

<div *ngIf="climb" class="wrap">
  <div class="hero" *ngIf="climb.heroUrl">
    <img [src]="climb.heroUrl" alt="{{climb.name}}" />
    <small *ngIf="climb.heroAttribution">{{climb.heroAttribution}}</small>
  </div>

  <h1>{{climb.name}} <span class="muted">• {{climb.type}} {{climb.yds}}</span></h1>
  <div class="muted" *ngIf="climb.area">{{climb.area.name}} {{climb.area.state ? '— ' + climb.area.state : ''}}</div>
  <p class="desc" *ngIf="climb.description">{{climb.description}}</p>

  <h3>Media</h3>
  <div class="media-grid">
    <ng-container *ngFor="let m of climb.media">
      <a [href]="m.url" target="_blank" *ngIf="!isVideo(m)" class="media">
        <img [src]="m.url" [alt]="m.caption || 'photo'">
      </a>
      <a [href]="m.url" target="_blank" *ngIf="isVideo(m)" class="media">
        <img [src]="m.thumbnailUrl || m.url" [alt]="m.caption || 'video'">
        <span class="badge">video</span>
      </a>
    </ng-container>
  </div>

  <div class="upload">
    <input id="fileInput" type="file" (change)="onFileChange($event)">
    <input type="text" placeholder="caption (optional)" [(ngModel)]="caption">
    <button (click)="upload()" [disabled]="uploading || !file">Upload</button>
  </div>

  <h3>Notes</h3>
  <div class="note-form">
    <textarea rows="3" placeholder="Share beta…" [(ngModel)]="noteText"></textarea>
    <button (click)="addNote()" [disabled]="posting || !noteText.trim()">Post note</button>
  </div>

  <div class="notes">
    <div class="note" *ngFor="let n of climb.notes">
      <div class="body">{{n.body}}</div>
      <div class="time">{{n.createdAt | date:'short'}}</div>
    </div>
  </div>
</div>